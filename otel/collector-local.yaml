receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

processors:
  memory_limiter:
    limit_mib: 128
    check_interval: 1s
    spike_limit_mib: 64

  batch:
    timeout: 5s
    send_batch_size: 512

  # Add demo.mode resource attribute for easy filtering
  transform/add_demo_mode:
    error_mode: ignore
    metric_statements:
      - context: resource
        statements:
          - set(attributes["demo.mode"], "firehose")

  # Add basic Kubernetes attributes but don't remove anything
  k8sattributes:
    auth_type: serviceAccount
    passthrough: true
    extract:
      labels:
        - tag_name: k8s.pod.label.app
          key: app
          from: pod
        - tag_name: k8s.namespace.name
          key: namespace
          from: pod

exporters:
  # Use Elasticsearch HTTP exporter for local development
  elasticsearch:
    endpoints:
      - http://host.docker.internal:9200
    # No authentication needed for local Elastic
    logs_index: metrics-generic
    metrics_index: metrics-generic
    flush:
      bytes: 524288
      interval: 10s

extensions:
  health_check:
    endpoint: 0.0.0.0:13133

service:
  pipelines:
    metrics:
      receivers: [otlp]
      processors: [memory_limiter, transform/add_demo_mode, k8sattributes, batch]
      exporters: [elasticsearch]

  extensions: [health_check]
